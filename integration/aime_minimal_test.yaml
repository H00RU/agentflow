device: "cuda"
# 超快速测试配置 - 3个epoch快速验证
total_epochs: 3  # 减少到3个epoch
episodes_per_epoch: 2  # 每个epoch 2个episode
update_frequency: 2  # 每2个episode更新一次
eval_episodes: 1  # 评估1个episode
save_frequency: 1

output_dir: "/content/drive/MyDrive/agentflow/outputs/minimal_test"
experience_pool_size: 300

environment:
  train_datasets:
    - "AIME"
  test_datasets:
    - "AIME"
  data_path: "/content/agentflow/AFlow/data/AIME_2024.jsonl"

  # 优化LLM配置 - 提升推理能力
  opt_llm_config:
    model: "gpt-4o-mini"
    key: "${OPENAI_API_KEY}"
    base_url: "https://api.openai.com/v1"
    temperature: 0.9

  exec_llm_config:
    model: "gpt-4o-mini"  # 保持使用mini观察性能
    key: "${OPENAI_API_KEY}"
    base_url: "https://api.openai.com/v1"
    temperature: 0.7  # 降低temperature提高稳定性

  # 提供多样化的operators让Qwen学习选择
  operators:
    - "Custom"           # 通用operator - 适合数学推理
    # "CustomCodeGenerate" - 代码生成operator，不适合AIME数学题，已移除
    - "ScEnsemble"       # 自一致性集成
    - "Test"             # 测试operator
    - "Review"           # 审查operator
    - "Revise"           # 修订operator

  env_num: 2  # 2个并行环境,增加探索
  group_n: 1
  max_rounds: 5  # 每个episode最多5轮
  validation_rounds: 3
  sample: 24  # 训练集大小（总共30题，24训练+6测试）

  # 动态优化模式配置
  use_dynamic_optimizer: true  # 启用动态优化（MCTS + RL）
  rl_weight: 0.5  # RL权重，平衡MCTS UCB和RL Q-value

  # 新增：workflow内部采样数配置
  # 这控制ScEnsemble生成多少个候选方案
  workflow_sample_count: 15  # 快速测试使用15次采样（平衡速度和质量）

rl:
  policy:
    model_path: "/root/models/Qwen2.5-7B-Instruct"
    use_lora: true
    lora_r: 16
    lora_alpha: 32
    value_head_dim: 1024

  # RL训练参数 - 针对AIME小数据集优化（24个训练样本）
  learning_rate: 0.0001  # 快速测试用稍高学习率
  batch_size: 4  # 小batch，适合少样本
  ppo_epochs: 3  # 快速测试减少epochs
  ppo_clip: 0.2
  gamma: 0.99
  gae_lambda: 0.95
  value_coef: 0.5
  entropy_coef: 0.05  # 适度探索
  gradient_clip: 1.0

  gigpo:
    enable: true
    epsilon: 0.000001
    step_advantage_w: 1.0  # 充分利用步骤级优势
    mode: "mean_norm"
    enable_similarity: true
    similarity_thresh: 0.95  # 避免重复探索
    workflow_similarity_thresh: 0.8  # 避免重复workflow

logging:
  level: "INFO"

debug:
  verbose_env: true
